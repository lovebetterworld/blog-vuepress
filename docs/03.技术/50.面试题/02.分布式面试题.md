---
title: 02.分布式面试题
date: 2022-04-19 11:20:00
permalink: /interview/61f871
categories: 
  - 面试题
tags: 
  - 
---

## 1 CAP理论

- **一致性（Consistency）：数据在多个副本之间是否能够保持一致的特性。（当一个系统在一致状态下更新后，应保持系统中所有数据仍处于一致的状态）**
- **可用性（Availability）：系统提供的服务必须一直处于可用状态，对每一个操作的请求必须在有限时间内返回结果。好的可用性主要是指系统能够很好的为用户服务，不出现用户操作失败或者访问超时等用户体验不好的情况**
- **分区容错性（Tolerance of network Partition）：分布式系统在遇到网络分区故障时，仍然需要保证对外提供一致性和可用性的服务，除非整个网络都发生故障；比如节点1和节点3出现故障，但是依然能够很好地对外提供服务。**
- **CAP理论是指在一个分布式系统中最多只能同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance）这三项中的两项**

![image-20211029170952632](http://www.itxiaoshen.com:3001/assets/1635499153569QESrXw43.png)

- 对于分布式系统来说，P(分区容忍性)是基本要求必须要保证的，否则就失去了价值，所以剩下要么CP组合，要么是AP组合。因此设计分布式数据系统，就是在一致性和可用性之间取一个平衡，对于大多数场景并不需要强一致性，因此牺牲一致性而换取高可用性，这个也是目前多数分布式数据库产品的方向。但这里很多人不要产生了误区，牺牲一致性并不是不要一致性，而是在可用性前提下尽可能提高数据一致性，而数据一致性从强到弱可以分为强一致性、最终一致性、弱一致性。
  - 强一致性
    - **对于关系型数据库，要求更新过的数据能被后续的访问都能看到，这是强一致性。比如小林更新values0到values1，那么小李读取值时也应该是values1。**
  - 弱一致性
    - **如果能容忍后续的部分或者全部访问不到，则是弱一致性。比如小林更新values0到values1，可以容忍那么小李读取值时是values0。**
  - 最终一致性
    - **如果经过一段时间后要求能访问到更新后的数据，则是最终一致性。比如小林更新values0到values1，可以使得小李在一段时间之后读取值时是values1。**

## 2 BASE理论

- **BASE包含 Basically Available(基本可用)、Soft state(软状态)和 Eventually consistent (最终一致性)这三个短语的缩写。**

![image-20211101091557665](http://www.itxiaoshen.com:3001/assets/1635729363731GH8t1ean.png)

- BASE理论是是eBay 的架构师 Dan Pritchett  提出,对CAP中AP的一个扩展，通过牺牲强一致性来获得可用性，当出现故障允许部分不可用但要保证核心功能可用，允许数据在一段时间内是不一致的，但最终达到一致状态。满足BASE理论的事务，我们称之为“柔性事务”。
  - **Basically Available 基本可用：分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用。可以体现在时间上的损失和功能上的损失。如部分用户双十一淘宝页面卡顿或降级处理。**
  - **Soft state  软状态：由于不要求强一致性，所以BASE允许系统中存在中间状态（也叫软状态），即系统的不同节点的数据副本之间的数据同步过程存在延迟，这个状态不影响系统可用性，如订单的"支付中"、“数据同步中”等状态，待数据最终一致后状态改为“成功”状态。**
  - **Eventually consistent 最终一致性：最终一致是指经过一段时间后，所有节点数据都将会达到一致。如订单的"支付中"状态，最终会变为“支付成功”或者"支付失败"，使订单状态与实际交易结果达成一致，但需要一定时间的延迟、等待。**