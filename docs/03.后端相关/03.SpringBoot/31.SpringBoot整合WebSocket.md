---
title: 31.SpringBoot 集成 WebSocket，实现后台向前端推送信息
date: 2022-05-26 14:20:00
permalink: /SpringBoot/springboot31/
categories: 
  - SpringBoot
  - WebSocket
tags: 
  - WebSocket
---

## 1 什么是websocket？

WebSocket协议是基于TCP的一种新的网络协议。它实现了客户端与服务器全双工通信，既然是全双工，就说明了服务器可以主动发送信息给客户端。

![image-20220526142204529](https://www.lovebetterworld.com:8443/uploads/2022/05/26/628f1c3e1d3a1.png)

为什么不使用HTTP 协议呢？这是因为HTTP是单工通信，通信只能由客户端发起，客户端请求一下，服务器处理一下，这就太麻烦了。于是websocket应运而生。

![image-20220526142214527](https://www.lovebetterworld.com:8443/uploads/2022/05/26/628f1c47ab3f3.png)

## 2 SpringBoot真个和Websocket

- [【十六】springboot整合WebSocket（超详细）_小z♂的博客-CSDN博客_springboot websocket](https://blog.csdn.net/weixin_56995925/article/details/120543965)

### 2.1 导入依赖

```xml
<dependency>
     <groupId>org.springframework.boot</groupId>
     <artifactId>spring-boot-starter-websocket</artifactId>
</dependency>
```

### 2.2 编写WebSocketConfig配置类

```java
@Configuration
public class WebSocketConfig(){
    @Bean
    public ServerEndpointExporter serverEndpointExporter(){
        return new ServerEndpointExporter();
    }
}
```

### 2.3 编写WebSocket类

```java
//注册成组件
@Component
//定义websocket服务器端，它的功能主要是将目前的类定义成一个websocket服务器端。
//注解的值将被用于监听用户连接的终端访问URL地址
@ServerEndpoint("/websocket")
//如果不想每次都写private  final Logger logger = LoggerFactory.getLogger(当前类名.class); 
//可以用注解@Slf4j;可以直接调用log.info
@Slf4j
public class WebSocket {
 
    //实例一个session，这个session是websocket的session
    private Session session;
    //存放websocket的集合
    private static CopyOnWriteArraySet<WebSocket> webSocketSet = new CopyOnWriteArraySet<>();
 
    //前端请求时一个websocket时
    @OnOpen
    public void onOpen(Session session) {
        this.session = session;
        webSocketSet.add(this);
        log.info("【websocket消息】有新的连接, 总数:{}", webSocketSet.size());
    }
 
    //前端关闭时一个websocket时
    @OnClose
    public void onClose() {
        webSocketSet.remove(this);
        log.info("【websocket消息】连接断开, 总数:{}", webSocketSet.size());
    }
 
    //前端向后端发送消息
    @OnMessage
    public void onMessage(String message) {
        log.info("【websocket消息】收到客户端发来的消息:{}", message);
    }
 
    //新增一个方法用于主动向客户端发送消息
    public static void sendMessage(String message) {
        for (WebSocket webSocket: webSocketSet) {
            log.info("【websocket消息】广播消息, message={}", message);
            try {
                webSocket.session.getBasicRemote().sendText(message);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
```

