---
title: 35.SpringBoot基于T-IO实现WebSocket
date: 2022-09-14 15:21:00
permalink: /SpringBoot/springboot35/
categories: 
  - SpringBoot
tags: 
  - SpringBoot
---

## 1 T-IO简介

- [即时通讯服务_语音聊天软件_企业即时通信软件-企业即时通讯软件-杭州钛特云 (tiocloud.com)](https://www.tiocloud.com/)

t-io是基于java开发的一款高性能网络编程框架。

## 2 SpringBoot整合T-IO实现WS

### 2.1 引入依赖

```xml
<dependency>
    <groupId>org.t-io</groupId>
    <artifactId>tio-websocket-spring-boot-starter</artifactId>
    <version>3.6.0.v20200315-RELEASE</version>
</dependency>
```

### 2.2 编写配置

```java
@Component
public class MyWebSocketMsgHandler implements IWsMsgHandler {
    @Override
    public HttpResponse handshake(HttpRequest httpRequest, HttpResponse httpResponse, ChannelContext channelContext) throws Exception {
        return httpResponse;
    }

    @Override
    public void onAfterHandshaked(HttpRequest httpRequest, HttpResponse httpResponse, ChannelContext channelContext) throws Exception {
        System.out.println("onAfterHandshaked  握手成功");
    }

    @Override
    public Object onBytes(WsRequest wsRequest, byte[] bytes, ChannelContext channelContext) throws Exception {
        System.out.println("onBytes  接收到bytes消息");
        return null;
    }

    @Override
    public Object onClose(WsRequest wsRequest, byte[] bytes, ChannelContext channelContext) throws Exception {
        System.out.println("onClose");
        return null;
    }

    @Override
    public Object onText(WsRequest wsRequest, String s, ChannelContext channelContext) throws Exception {
        System.out.println("onText 接收到文本消息："+s);
        return "应答消息:"+s;
    }
}
```

### 2.2 主动推送

```java
@RestController
@RequestMapping("/push")
public class PushController {

    @Autowired
    private TioWebSocketServerBootstrap bootstrap;

    /**
     * 消息群发
     * @param msg
     */
    @GetMapping("/msg")
    public void pushMessage(String msg){
        if (StrUtil.isEmpty(msg)){
            msg = "hello tio websocket spring boot starter";
        }
        Tio.sendToAll(bootstrap.getServerTioConfig(), WsResponse.fromText(msg,"utf-8"));
    }
}
```

### 2.3 启动类

```java
@SpringBootApplication
@EnableTioWebSocketServer
public class Main {
    public static void main(String[] args) {
        SpringApplication.run(Main.class, args);
    }
}
```

### 2.4 配置文件

```yaml
tio:
  websocket:
    server:
      port: 9876
      heartbeat-timeout: 60000
```

